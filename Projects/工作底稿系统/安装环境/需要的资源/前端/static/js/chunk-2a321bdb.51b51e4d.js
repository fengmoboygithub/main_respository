(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2a321bdb"],{"0f32":function(e,t,i){},"7d59":function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:">>"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-lx-redpacket_fill"}),e._v(" "+e._s(e.projectInfo.projectname)+"\n                ")]),i("el-breadcrumb-item",[e._v(e._s(e.projectInfo.stagename))])],1)],1),i("div",{staticClass:"container"},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("tree",{attrs:{setting:e.setting,nodes:e.nodes},on:{onClick:e.onClick,onRightClick:e.onRightClick,onCheck:e.onCheck,onCreated:e.handleCreated}})],1),i("el-col",{attrs:{span:12}},[e.showFile?i("div",[i("div",{staticClass:"content-title"},[e._v(e._s(e.fileInfo.docname))]),e.showNotFileVersion?i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:8}},[i("el-tag",{attrs:{type:"success"}},[e._v("上传人:"+e._s(e.fileInfo.docname))])],1),i("el-col",{attrs:{span:8}},[i("el-tag",{attrs:{type:"success"}},[e._v("修改次数:"+e._s(e.fileInfo.updatecount))])],1),i("el-col",{attrs:{span:8}},[i("el-tag",{attrs:{type:"success"}},[e._v("上传时间:"+e._s(e.fileInfo.uploaddate))])],1)],1):e._e(),i("el-row",[i("v-pdf",{attrs:{url:e.fileInfo.fileUrl,pdfStyle:"display: inline-block; width: 100%; height: 100%;border: solid 1px;"}})],1)],1):e._e(),e.showDir?i("div",[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:20}},[i("div",{staticClass:"plugins-tips"},[e._v(e._s(e.dirInfo.name))])]),i("el-col",{attrs:{span:4}},[i("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出意见")])],1)],1),i("div",{staticClass:"content-title"},[e._v("文件上传")]),i("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{drag:"","before-upload":e.beforeAvatarUpload,action:"",accept:".pdf","http-request":e.submitUpload,multiple:!0}},[i("i",{staticClass:"el-icon-upload"}),i("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),i("em",[e._v("点击上传")])]),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传pdf文件，且不超过1024M")])]),i("div",{staticClass:"content-title"},[e._v("历史意见")]),i("el-table",{ref:"hisOpinionTable",staticClass:"table",attrs:{data:e.hisOpinionTableData,border:"","header-cell-class-name":"table-header"}},[i("el-table-column",{attrs:{prop:"id",label:"ID",width:"75",align:"center"}}),i("el-table-column",{attrs:{prop:"createUser",label:"发表人"}}),i("el-table-column",{attrs:{prop:"createTime",label:"发表时间"}}),i("el-table-column",{attrs:{prop:"contents",label:"意见"}})],1),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.query.currentPage,"page-size":e.query.itemsPerPage,total:e.pageTotal},on:{"current-change":e.handlePageChange}})],1),i("el-row",[i("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("提交")])],1)],1):e._e(),e.showExamineDir?i("div",[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:20}},[i("div",{staticClass:"plugins-tips"},[e._v(e._s(e.dirInfo.name))])]),i("el-col",{attrs:{span:4}},[i("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出意见")])],1)],1),i("div",{staticClass:"content-title"},[e._v("发表意见")]),i("el-input",{attrs:{type:"textarea",rows:10,placeholder:"请输入意见"},model:{value:e.opinion,callback:function(t){e.opinion=t},expression:"opinion"}}),i("el-row",[i("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("发表")])],1),i("div",{staticClass:"content-title"},[e._v("历史意见")]),i("el-table",{ref:"hisOpinionTable",staticClass:"table",attrs:{data:e.hisOpinionTableData,border:"","header-cell-class-name":"table-header"}},[i("el-table-column",{attrs:{prop:"id",label:"ID",width:"75",align:"center"}}),i("el-table-column",{attrs:{prop:"createUser",label:"发表人"}}),i("el-table-column",{attrs:{prop:"createTime",label:"发表时间"}}),i("el-table-column",{attrs:{prop:"contents",label:"意见"}})],1),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.query.currentPage,"page-size":e.query.itemsPerPage,total:e.pageTotal},on:{"current-change":e.handlePageChange}})],1),i("el-row",[i("el-button",{attrs:{type:"danger",plain:""},on:{click:e.onBack}},[e._v("退回")]),i("el-button",{attrs:{type:"success",plain:""},on:{click:e.onAgree}},[e._v("同意")])],1)],1):e._e()])],1)],1)])},n=[],a=(i("7f7f"),i("ac6a"),i("f419")),s=i.n(a),r=i("2d8b"),l=i("f121"),c={name:"upload",components:{tree:s.a,vPdf:r["a"]},data:function(){return{query:{directoryId:"",projectId:"",currentPage:1,itemsPerPage:10},projectInfo:{id:"",projectname:"",projectno:"",projecttype:"",stage:"",stagename:""},dirInfo:null,fileInfo:{docname:"",username:"",uploaddate:"",updatecount:"",fileUrl:""},opinion:"",hisOpinionTableData:[],pageTotal:0,nodes:[],showFile:!1,showNotFileVersion:!1,showDir:!1,showExamineDir:!1,resourcePath:l["a"].ME_IP_INFO+l["a"].FILE_BASEURL,uploadFile:{projectid:"",directoryid:""},ztreeObj:null,setting:{check:{enable:!0,nocheckInherit:!0,chkboxType:{Y:"s",N:"ps"}},data:{simpleData:{enable:!0,pIdKey:"pid"}},view:{showIcon:!1,addDiyDom:this.addDiyDom,removeHoverDom:this.removeHoverDom}}}},created:function(){this.getProjectInfo(),this.initTree()},activated:function(){this.getProjectInfo(),this.initTree()},methods:{getHisOpinionTableData:function(){var e=this;this.query.directoryId=this.dirInfo.id,this.query.projectId=this.dirInfo.projectid,this.net.getListByPage_DirectoryOpinion(this.query).then((function(t){console.log(t),e.hisOpinionTableData=t.data,e.pageTotal=t.recordsTotal||0}))},handlePageChange:function(e){this.$set(this.query,"pageIndex",e),this.getHisOpinionTableData()},getProjectInfo:function(){var e=this;this.net.get_ProjectInfo({id:this.$route.query.id}).then((function(t){console.log(t),e.projectInfo=t.entity})).catch((function(t){e.$message.error("项目信息数据加载失败"),console.log(t)}))},selectNodeById:function(e){var t=this,i=this.nodes;e&&i.length>0&&i.some((function(i){if(console.log(i),i.id==e)return t.ztreeObj&&t.ztreeObj.selectNode(i),t.onClick(null,e,i),!0}))},initTree:function(){var e=this;this.net.viewTree({projectid:this.$route.query.id,projectStage:this.$route.query.projectStage}).then((function(t){console.log(t);var i=t;i.success&&200===i.code&&(e.nodes=i.list)})).catch((function(t){e.$message.error("目录树数据加载失败"),console.log(t)}))},addDiyDom:function(e,t){var i=document.getElementById("".concat(t.tId,"_a"));if(i&&!i.querySelector(".tree_extra_btn")){var o=document.createElement("sapn");o.id="".concat(e,"_").concat(t.id,"_btn"),o.classList.add("tree_extra_btn"),o.innerText=t.processnodename,i.appendChild(o)}},rightClickHoverDom:function(e,t){var i=this,o=document.getElementById("".concat(t.tId,"_a"));if(o&&!o.querySelector(".tree_extra_menu")){var n=document.createElement("ul");if(n.id="".concat(e,"_").concat(t.id,"_ul"),n.classList.add("tree_extra_menu","el-menu","el-menu--popup","el-menu--popup-right-start"),"dir"===t.type){var a=document.createElement("li");a.tabindex="-1",a.classList.add("tree_extra_menuitem","el-menu-item"),a.innerText="操作",a.addEventListener("click",(function(o){o.stopPropagation(),i.onClick(o,e,t)})),a.addEventListener("mouseover",(function(e){e.stopPropagation(),a.classList.remove("tree_extra_menuitem"),a.classList.add("tree_extra_menuitem_hover")})),a.addEventListener("mouseout",(function(e){e.stopPropagation(),a.classList.add("tree_extra_menuitem"),a.classList.remove("tree_extra_menuitem_hover")})),n.appendChild(a),o.appendChild(n)}else{var s=document.createElement("li");s.tabindex="-1",s.role="menuitem",s.setAttribute("aria-haspopup","true"),s.classList.add("el-submenu");var r=document.createElement("div");r.classList.add("tree_extra_menuitem","el-submenu__title"),r.innerText="查看历史版本";var l=document.createElement("i");l.classList.add("el-submenu__icon-arrow","el-icon-arrow-right"),r.addEventListener("mouseover",(function(e){e.stopPropagation(),r.classList.remove("tree_extra_menuitem"),r.classList.add("tree_extra_menuitem_hover");var t=s.querySelector(".el-menu--vertical");t.classList.remove("display_none"),t.classList.add("display_block")})),r.addEventListener("mouseout",(function(e){e.stopPropagation(),r.classList.add("tree_extra_menuitem"),r.classList.remove("tree_extra_menuitem_hover");var t=s.querySelector(".el-menu--vertical");t.classList.remove("display_block"),t.classList.add("display_none")})),r.appendChild(l);var c=document.createElement("div");c.setAttribute("x-placement","right-start"),c.classList.add("vertical_me","el-menu--vertical","display_none");var d=document.createElement("ul");if(d.classList.add("tree_extra_menu","el-menu","el-menu--popup","el-menu--popup-right-start"),d.role="menu",this.net.getListByPage_ManuscriptVersion({currentPage:1,itemsPerPage:10,projectId:t.projectid,docId:t.id}).then((function(e){console.log(e),e.data.forEach((function(e){console.log(e);var o=e.version,n=e.hashname,a=document.createElement("li");a.classList.add("tree_extra_menuitem","el-menu-item"),a.role="menuitem",a.tabindex="-1",a.innerText="V"+o,a.hashname=n,a.addEventListener("click",(function(e){e.stopPropagation(),i.showFileVersionInfo({hashname:n,docname:t.name+"V"+o})})),a.addEventListener("mouseover",(function(e){e.stopPropagation(),a.classList.remove("tree_extra_menuitem"),a.classList.add("tree_extra_menuitem_hover")})),a.addEventListener("mouseout",(function(e){e.stopPropagation(),a.classList.add("tree_extra_menuitem"),a.classList.remove("tree_extra_menuitem_hover")})),d.appendChild(a)}))})).catch((function(e){console.log(e)})),c.appendChild(d),s.appendChild(r),s.appendChild(c),n.appendChild(s),o.appendChild(n),t.isdel){var u=document.createElement("li");u.tabindex="-1",u.classList.add("tree_extra_menuitem","el-menu-item"),u.innerText="删除",u.addEventListener("click",(function(e){e.stopPropagation(),i.clickRemove(t)})),u.addEventListener("mouseover",(function(e){e.stopPropagation(),u.classList.remove("tree_extra_menuitem"),u.classList.add("tree_extra_menuitem_hover")})),u.addEventListener("mouseout",(function(e){e.stopPropagation(),u.classList.add("tree_extra_menuitem"),u.classList.remove("tree_extra_menuitem_hover")})),n.appendChild(u)}}}},removeHoverDom:function(e,t){var i=document.getElementById("".concat(t.tId,"_a"));if(i){var o=i.querySelector(".tree_extra_menu");o&&i.removeChild(o)}},clickRemove:function(e){var t=this;console.log("remove",e),this.net.del_ManuscriptInfo({id:e.id}).then((function(i){200===i.code?(t.ztreeObj&&t.ztreeObj.removeNode(e),t.$message.success("底稿信息删除成功")):t.$message.error("底稿信息删除失败")})).catch((function(e){t.$message.error("服务器错误，底稿信息删除失败！")}))},onClick:function(e,t,i){if(i)if("file"==i.type)this.seeFileNet({id:i.id}),this.showFile=!0,this.showNotFileVersion=!0,this.showDir=!1,this.showExamineDir=!1;else{var o=0;i.processnode&&(o=parseInt(i.processnode)),console.log(o),o<19?(console.log("上传"),this.uploadFileHover(e,t,i)):(console.log("审核"),this.exmineFileHover(e,t,i))}else this.showFile=!1,this.showNotFileVersion=!1,this.showDir=!1,this.showExamineDir=!1},uploadFileHover:function(e,t,i){console.log(e.type,i),i?"dir"==i.type&&(this.noEnableChk(this.dirInfo),this.enableChk(i),this.dirInfo=i,this.uploadFile.projectid=i.projectid,this.uploadFile.directoryid=i.id,this.getHisOpinionTableData(),this.showFile=!1,this.showNotFileVersion=!1,this.showDir=!0,this.showExamineDir=!1):(this.showFile=!1,this.showNotFileVersion=!1,this.showDir=!1,this.showExamineDir=!1)},exmineFileHover:function(e,t,i){console.log(e.type,i),i?i.isParent&&(this.noEnableChk(this.dirInfo),this.enableChk(i),this.dirInfo=i,this.getHisOpinionTableData(),this.showFile=!1,this.showNotFileVersion=!1,this.showDir=!1,this.showExamineDir=!0):(this.showFile=!1,this.showNotFileVersion=!1,this.showDir=!1,this.showExamineDir=!1)},onCheck:function(e,t,i){console.log(e.type,i)},onRightClick:function(e,t,i){console.log(e.type,i),this.rightClickHoverDom(t,i)},handleCreated:function(e){this.ztreeObj=e,e.expandAll(!0)},beforeAvatarUpload:function(e){var t=e.size/1024/1024<1024;return t||this.$message.error("上传文件大小不能超过 1024MB!"),t},seeFileNet:function(e){var t=this;this.net.get_ManuscriptInfo({id:e.id}).then((function(e){200===e.code?(t.$message.success("底稿信息获取成功"),t.fileInfo.fileUrl=t.resourcePath+e.entity.hashname,t.fileInfo.docname=e.entity.docname,t.fileInfo.username=e.entity.username,t.fileInfo.uploaddate=e.entity.uploaddate,t.fileInfo.updatecount=e.entity.updatecount):t.$message.error("底稿信息获取失败")})).catch((function(e){t.$message.error("服务器错误，底稿信息获取失败！")}))},showFileVersionInfo:function(e){this.fileInfo.fileUrl=this.resourcePath+e.hashname,this.fileInfo.docname=e.docname,this.showFile=!0,this.showNotFileVersion=!1,this.showDir=!1,this.showExamineDir=!1},submitUpload:function(e){var t=this,i=e.file,o=new FormData;o.append("file",i),o.append("projectid",this.uploadFile.projectid),o.append("directoryid",this.uploadFile.directoryid),this.net.add_ManuscriptInfo(o).then((function(e){200===e.code?(t.$message.success("上传成功"),t.showFile=!0,t.showNotFileVersion=!0,t.showDir=!1,t.initTree(e.entity.id),t.selectNodeById(e.entity.id)):t.$message.error("上传失败")})).catch((function(e){t.$message.error("服务器错误，上传文件失败！")}))},optMenthod:function(e,t){var i=this,o=this.ztreeObj.getCheckedNodes(!0);if(null==o||0==o.length)this.$message.error("请勾选要提交的目录");else{console.log(o);var n=this,a=[];o.forEach((function(e){if(2==e.check_Child_State){var t={id:e.id,opinion:n.opinion,type:e.type,pid:e.pid,processnode:e.processnode};a.push(t);var i=e.children;i&&i.length>0&&i.forEach((function(e){if("file"==e.type){var t={id:e.id,opinion:"",type:e.type,pid:e.pid,processnode:e.processnode,hashname:e.hashname,docname:e.docname};a.push(t)}}))}}));var s={projectid:this.$route.query.id,projectStage:this.$route.query.projectStage,processnode:this.dirInfo.processnode,operId:e,treedag:JSON.stringify(a)};this.net.updateProcess_ProcessNodeInfo(s).then((function(e){200===e.code?i.$message.success(t+"成功"):i.$message.error(t+"失败")})).catch((function(e){i.$message.error(t+"失败！")}))}},onSubmit:function(){this.optMenthod("1","提交")},onBack:function(){this.optMenthod("2","退回")},onSave:function(){this.optMenthod("3","发表")},onAgree:function(){this.optMenthod("1","同意")},onExport:function(){},enableChk:function(e){if(e){var t=this;t.ztreeObj.setChkDisabled(e,!1,!1,!0)}},noEnableChk:function(e){if(e){var t=this;t.ztreeObj.setChkDisabled(e,!0,!1,!0)}}}},d=c,u=(i("e4be"),i("2877")),p=Object(u["a"])(d,o,n,!1,null,null,null);t["default"]=p.exports},e4be:function(e,t,i){"use strict";var o=i("0f32"),n=i.n(o);n.a}}]);